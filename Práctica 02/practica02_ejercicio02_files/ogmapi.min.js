(function(f,h,g){var a=function(){return new a.fn.init};a.fn=a.prototype={init:function(){return this}};a.api_server="127.0.0.1";a.api_port=12071;a.api_version="v1";a.service_version=null;a.compatible=!1;a.games=[];a._readyfunc=[];a._initInterval=0;a.init=function(){a.serviceQuery("init",{},a.__init);a.serviceQuery("init",{api_port:17021},a.__init)};a.isServiceCompatible=function(){return a.compatible!=null};a.isServiceInstalled=function(){return a.service_version!=null};a.queryGames=function(a,b){this.serviceQuery("list",
{affiliate:a},function(a){b(a.games||[],a.error||null)})};a.playGame=function(a,b){this.serviceQuery("play",{cid:a},b)};a.setCustomData=function(a,b){b.cid=a;this.serviceQuery("setCustomData",b)};a.clearCustomData=function(a){this.serviceQuery("delCustomData",{cid:a})};a.delCustomData=function(a,b){typeof b=="string"&&(b=[b]);this.serviceQuery("delCustomData",{cid:a,keys:b.join(",")})};a.postSharedMessage=function(a,b,c){a={queue:a==null?"":a};for(var d=Object.keys(b),i=0;i<d.length;i++)a["data_"+
d[i]]=b[d[i]];this.serviceQuery("postSharedMessage",a,c||null)};a.getSharedMessage=function(a,b,c){this.serviceQuery("getSharedMessage",{id:a,"public":b||!1},c)};a.filterSharedMessages=function(a,b){this.serviceQuery("filterSharedMessages",{queue:a.queue||"","public":a["public"]||!1,count:a.count||100,sort:a.sort||"lifo"},b)};a.lastSharedMessage=function(a,b,c){this.serviceQuery("lastSharedMessage",{queue:a==null?"":a,"public":b?1:0},c)};a.installStubby=function(e,b){var c={},d=b||null;typeof e==
"object"&&(c=e);c.url=c.url||e;c.title=c.title||"";c.silent=c.silent||!1;this.serviceQuery("installStubby",c,function(b){if(b.error!=null)d(b);else if("message_queue"in b)var c=b.message_queue,e=setInterval(function(){a.lastSharedMessage(c,!0,function(a){(!("data"in a)||!("status"in a.data)||a.data.status=="success"||a.data.status=="error")&&clearInterval(e);d(a)})},1E3);else d({error:"invalid_message_queue"})})};a.queryInstallers=function(a){this.serviceQuery("listInstallers",{},function(b){typeof b.list==
g||b.list.length==0?a([],b.error||null):a(b.list,b.error||null)})};a.notifyInstallers=function(e,b){return setInterval(function(){a.queryInstallers(e)},b||5E3)};a.uninstall=function(a,b){this.serviceQuery("uninstall",{cid:a},b)};a.serviceQuery=function(e,b,c){var d=(new Date).getTime();b=b||{};var f=b.api_port||a.api_port;b.query_id=d;a.ajax("http://"+a.api_server+":"+f+"/"+a.api_version+"/"+e+".json",c||null,b);return""+d};a.ajax=function(e,b,c){var d={};c=a.serialize(c||"");d.r=null;try{if(f.XDomainRequest)d.r=
new XDomainRequest;else if(f.XMLHttpRequest)d.r=new XMLHttpRequest;else return this}catch(g){return this}e+=c.length>0?"?"+c:"";c="";d.r.open("GET",e,!0);f.XDomainRequest?d.r.onload=function(){var a=d.r.responseText;if("js".charAt(0)=="x")a=d.r.responseXML;"js".charAt(0)=="j"&&(a=(new Function("return "+a.replace(/[\n\r]/g,"")))());b&&b(a)}:d.r.onreadystatechange=function(){if(d.r.readyState==4&&d.r.status==200){var a=d.r.responseText;if("js"[0]=="x")a=d.r.responseXML;"js"[0]=="j"&&(a=(new Function("return "+
a.replace(/[\n\r]/g,"")))());b&&b(a)}};d.r.send(c);return this};a.serialize=function(a){var b,c="";if(typeof a!="object")return a;for(b in a)c+="&"+encodeURIComponent(b)+"="+encodeURIComponent(a[b]);return c.substr(1)};a.__init=function(e){a.service_version=e.service_version;a.api_port=e.api_port;if(parseInt(a.api_version.substr(1))>parseInt(e.api_version.substr(1))){if(a._initInterval==0)a._initInterval=setInterval(function(){a.init()},3E4)}else a.compatible=!0,clearInterval(a._initInterval),e=function(){var b=
a._readyfunc;a._readyfunc=[];for(var c=0;c<b.length;c++)b[c].call(a,a.compatible)},e(),setInterval(e,1E3)};a.ready=function(e){a._readyfunc[a._readyfunc.length]=e};a.fn.init.prototype=a.fn;f[h]=a;a.init()})(window,"ogmapi");if(!Object.keys)Object.keys=function(f){if(f!==Object(f))throw new TypeError("Object.keys called on non-object");var h=[],g;for(g in f)Object.prototype.hasOwnProperty.call(f,g)&&h.push(g);return h};
